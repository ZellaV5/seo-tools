<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>æ‰¹é‡ URL è®¿é—®å·¥å…·</title>
</head>
<body>
  <h2>æ‰¹é‡URLç¼“å­˜æ¸…ç†å·¥å…·</h2>

  <textarea id="userUrls" placeholder="è¯·è¾“å…¥å¤šä¸ª URLï¼Œæ¯è¡Œä¸€ä¸ª" rows="10" style="width: 600px;"></textarea><br><br>

  <fieldset style="width: 600px;">
    <legend>å¯é€‰è¯­è¨€ï¼ˆå¯å¤šé€‰ï¼‰</legend>
    <div style="display: flex; flex-direction: column;">
      <label><input type="checkbox" value="en"> è‹±è¯­ - EN</label>
      <label><input type="checkbox" value="es"> è¥¿è¯­ - ES</label>
      <label><input type="checkbox" value="pt"> è‘¡è¯­ - PT</label>
      <label><input type="checkbox" value="ru"> ä¿„è¯­ - RU</label>
      <label><input type="checkbox" value="fr"> æ³•è¯­ - FR</label>
      <label><input type="checkbox" value="de"> å¾·è¯­ - DE</label>
      <label><input type="checkbox" value="tw"> ç¹ä¸­ - TW</label>
      <label><input type="checkbox" value="zh"> ç®€ä¸­ - CN</label>
      <label><input type="checkbox" value="jp"> æ—¥è¯­ - JP</label>
      <label><input type="checkbox" value="id"> å°å°¼è¯­ - ID</label>
      <label><input type="checkbox" value="it"> æ„å¤§åˆ©è¯­ - IT</label>
      <label><input type="checkbox" value="th"> æ³°è¯­ - TH</label>
      <label><input type="checkbox" value="vi"> è¶Šå—è¯­ - VI</label>
      <label><input type="checkbox" value="tr"> åœŸè€³å…¶è¯­ - TR</label>
      <label><input type="checkbox" value="pl"> æ³¢å…°è¯­ - PL</label>
      <label><input type="checkbox" value="nl"> è·å…°è¯­ - NL</label>
      <label><input type="checkbox" value="ko"> éŸ©è¯­ - KO</label>
    </div>
  </fieldset><br>

  <button onclick="runBatchTask()">ç¬¬ä¸€æ­¥ï¼šè®¿é—®ç¼“å­˜URL</button><br><br>

  <hr>

  <h3>ç¬¬äºŒæ­¥ï¼šç”Ÿæˆ CDN æäº¤åœ°å€</h3>
  <input id="cdnBaseUrl" placeholder="è¯·è¾“å…¥ URL" style="width: 600px;" />
  <button onclick="generateCdnUrls()">ç”Ÿæˆ CDN åœ°å€</button>

  <div id="cdnOutput" style="margin-top: 10px;"></div>

  <script>
    function getSelectedLangs() {
      const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
      return Array.from(checkboxes).map(cb => cb.value);
    }

    function runBatchTask() {
      const inputText = document.getElementById('userUrls').value.trim();
      const selectedLangs = getSelectedLangs();

      if (!inputText) {
        alert('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ª URL');
        return;
      }

      const urls = inputText.split('\n').map(url => url.trim()).filter(Boolean);

      for (const input of urls) {
        if (!input.startsWith('http')) {
          alert(`URL æ ¼å¼é”™è¯¯ï¼š${input}`);
          continue;
        }

        try {
          const urlObj = new URL(input);
          const host = 'https://marketing-site-next-643-pro-aws-oregon.everimaging.cn/_cache?url=';
          let pathname = urlObj.pathname;
          if (!pathname.endsWith('/')) pathname += '/';

          const fullUrl = `${host}${pathname}`;
          window.open(fullUrl, '_blank');

          // æ‰“å¼€è¯­è¨€ç‰ˆæœ¬
          for (const lang of selectedLangs) {
            const langCode = lang === 'zh' ? 'cn' : lang;
            const langUrl = `${host}/${langCode}${pathname}`;
            window.open(langUrl, '_blank');
          }

        } catch (e) {
          alert(`URL è§£æå¤±è´¥ï¼š${input}`);
        }
      }
    }

    function generateCdnUrls() {
      const input = document.getElementById('cdnBaseUrl').value.trim();
      const selectedLangs = getSelectedLangs();

      if (!input || !input.startsWith('http')) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ URL');
        return;
      }

      try {
        const urlObj = new URL(input);
        const origin = urlObj.origin;
        let basePath = urlObj.pathname;
        if (basePath.endsWith('/')) {
          basePath = basePath.slice(0, -1);
        }

        let resultUrls = [];
        let baseUrlWithAsterisk = `${origin}${basePath}*`;
        resultUrls.push(`<li><code>${baseUrlWithAsterisk}</code></li>`); // ç”¨æˆ·æäº¤çš„ URL æ”¹å†™ç‰ˆæ”¾åœ¨ç¬¬ä¸€æ’

        if (selectedLangs.length === 0) {
          resultUrls.push(`<li><code>${baseUrlWithAsterisk}</code></li>`);
        } else {
          for (const lang of selectedLangs) {
            const langCode = lang === 'zh' ? 'cn' : lang;
            const langUrl = `${origin}/${langCode}${basePath}*`;
            resultUrls.push(`<li><code>${langUrl}</code></li>`);
          }
        }

        const outputHtml = `
          <p>ğŸ‘‰ <a href="http://cdn.everimaging.cn/cdn/" target="_blank">CDNæäº¤åœ°å€</a></p>
          <p>ğŸ‘‡ ä»¥ä¸‹æ˜¯æ”¹å†™åçš„ CDN æäº¤åœ°å€ï¼Œç‚¹å‡»å¤åˆ¶ï¼š</p>
          <ul>${resultUrls.join('')}</ul>
        `;
        document.getElementById('cdnOutput').innerHTML = outputHtml;

      } catch (e) {
        alert('URL è§£æå¤±è´¥');
      }
    }
  </script>
</body>
</html>
