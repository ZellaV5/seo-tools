<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>æ‰¹é‡ URL è®¿é—®å·¥å…·</title>
</head>
<body>
  <h2>æ‰¹é‡URLç¼“å­˜æ¸…ç†å·¥å…·</h2>
  <textarea id="userUrls" placeholder="è¯·è¾“å…¥å¤šä¸ª URLï¼Œæ¯è¡Œä¸€ä¸ª" rows="10" style="width: 600px;"></textarea><br>
  <button onclick="runBatchTask()">æ‰§è¡Œä»»åŠ¡</button>

  <div id="output" style="margin-top: 20px;"></div>

  <script>
    function runBatchTask() {
      const inputText = document.getElementById('userUrls').value.trim();
      if (!inputText) {
        alert('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ª URL');
        return;
      }

      const urls = inputText.split('\n').map(url => url.trim()).filter(Boolean);
      let cdnList = [];

      for (const input of urls) {
        if (!input.startsWith('http')) {
          alert(`URL æ ¼å¼é”™è¯¯ï¼š${input}`);
          continue;
        }

        try {
          const urlObj = new URL(input);
          const pathParts = urlObj.pathname.split('/').filter(p => p);
          let newPath = '';

          if (pathParts[0] === 'features') {
            if (pathParts.length > 2) {
              // æƒ…å†µ 3ï¼šfeatures + å¤šçº§è·¯å¾„ï¼Œåˆå¹¶ä¸º slug
              const slug = pathParts.slice(1).join('-');
              newPath = '/features/' + slug + '/';
            } else {
              // å·²æœ‰ features ä¸”ä¸ºä¸€çº§æˆ–ä¸¤çº§ï¼Œä¸å˜
              newPath = urlObj.pathname;
              if (!newPath.endsWith('/')) newPath += '/';
            }
          } else {
            if (pathParts.length === 1) {
              // æƒ…å†µ 1ï¼šä¸å« features ä¸”ä¸€çº§è·¯å¾„ï¼ŒåŠ  features
              newPath = '/features/' + pathParts[0] + '/';
            } else if (pathParts.length >= 2) {
              // æƒ…å†µ 2ï¼šä¸å« features ä¸”å¤šçº§è·¯å¾„ï¼Œåˆå¹¶ä¸º slug
              const slug = pathParts.join('-');
              newPath = '/features/' + slug + '/';
            }
          }

          const cacheUrl = `https://marketing-site-next-643-pro-aws-oregon.everimaging.cn/_cache?url=${newPath}`;
          window.open(cacheUrl, '_blank');

          let cdnUrl = input.endsWith('/') ? input.slice(0, -1) + '*' : input + '*';
          cdnList.push(cdnUrl);

        } catch (e) {
          alert(`URL è§£æå¤±è´¥ï¼š${input}`);
        }
      }

      // å±•ç¤ºæ‰€æœ‰ CDN æäº¤åœ°å€
      const outputHtml = `
        <p>ğŸ‘‰ ç¬¬äºŒæ­¥è¯·å‰å¾€ <a href="http://cdn.everimaging.cn/cdn/" target="_blank">CDN æäº¤é¡µé¢</a>ï¼Œæ‰‹åŠ¨æäº¤ä»¥ä¸‹åœ°å€ï¼ˆå¸¦ *ï¼‰ï¼š</p>
        <ul>${cdnList.map(url => `<li><code>${url}</code></li>`).join('')}</ul>
      `;
      document.getElementById('output').innerHTML = outputHtml;
    }
  </script>
</body>
</html>
